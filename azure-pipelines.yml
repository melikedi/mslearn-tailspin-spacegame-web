trigger:
  - main # or master if your repo uses master

pool:
  vmImage: "windows-2022"

steps:
  - task: UseDotNet@2
    displayName: "Use .NET SDK"
    inputs:
      version: "8.x"

  - script: dotnet restore
    displayName: "Restore dependencies"

  - script: dotnet build --configuration Release --no-restore
    displayName: "Build"

  - script: dotnet test --configuration Release --no-build
    displayName: "Run tests"

  - script: dotnet publish --configuration Release --no-build --output $(Build.ArtifactStagingDirectory)/publish
    displayName: "Publish"

  - task: PublishPipelineArtifact@1
    displayName: "Publish pipeline artifact"
    inputs:
      PathtoPublish: "$(Build.ArtifactStagingDirectory)/publish"
      ArtifactName: "drop"
